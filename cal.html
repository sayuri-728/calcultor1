<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>損益額・損益pips 計算機</title>
    <style>
        body { font-family: sans-serif; padding: 10px; background: #f0f4f8; margin: 0; }
        .box { background: white; padding: 15px 20px; border-radius: 12px; max-width: 400px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; margin: 0 0 15px 0; color: #2c3e50; font-size: 18px; }
        
        .input-group { margin-bottom: 12px; }
        label { display: block; font-weight: bold; font-size: 13px; color: #444; margin-bottom: 3px; }
        input, select { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        
        .live-preview { font-size: 11px; color: #666; text-align: right; margin-top: 2px; height: 14px; }
        
        /* 結果表示エリア */
        .results-container { display: flex; gap: 10px; margin-top: 15px; }
        .result-card { flex: 1; padding: 10px; border-radius: 10px; text-align: center; }
        
        .profit-card { background: #e6fffa; border: 2px solid #38b2ac; }
        .pips-card { background: #fff3e0; border: 2px solid #ffb74d; }
        
        .res-label { font-size: 12px; font-weight: bold; margin-bottom: 5px; }
        .res-value { font-size: 22px; font-weight: bold; }
        .res-unit { font-size: 12px; }

        .note { font-size: 11px; color: #888; margin-top: 15px; line-height: 1.5; background: #f9f9f9; padding: 8px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="box">
    <h2>損益額・損益pips 計算機</h2>

    <div class="input-group">
        <label>通貨ペア種別</label>
        <select id="type" onchange="changeType()">
            <option value="jpy">クロス円 (USD/JPY, EUR/JPY等)</option>
            <option value="usd">ドルストレート (EUR/USD等)</option>
            <option value="eurgbp">ユーロポンド (EUR/GBP)</option>
        </select>
    </div>

    <div class="input-group">
        <label>エントリーレート</label>
        <input type="number" id="entry" value="150.000" step="0.001" oninput="run()">
    </div>

    <div class="input-group">
        <label>決済レート</label>
        <input type="number" id="settle" value="150.500" step="0.001" oninput="run()">
    </div>

    <div class="input-group">
        <label>取引数量 (通貨)</label>
        <input type="text" id="qty" value="10,000" oninput="formatAndRun(this)">
    </div>

    <div id="rateBox" style="display:none;">
        <div class="input-group">
            <label id="rateLabel">対円為替レート</label>
            <input type="number" id="baseRate" value="150.00" step="0.01" oninput="run()">
            <div class="live-preview">※決済通貨を円に換算</div>
        </div>
    </div>

    <div class="results-container">
        <div class="result-card profit-card">
            <div class="res-label" style="color: #2c7a7b;">損益額</div>
            <div class="res-value" id="resProfit" style="color: #2c7a7b;">---</div>
            <div class="res-unit" style="color: #2c7a7b;">円</div>
        </div>
        <div class="result-card pips-card">
            <div class="res-label" style="color: #e65100;">損益pips</div>
            <div class="res-value" id="resPips" style="color: #e65100;">---</div>
            <div class="res-unit" style="color: #e65100;">pips</div>
        </div>
    </div>

    <div class="note" id="noteArea">
        pips計算: 0.01 = 1pips<br>損益計算: pips × 0.01 × 数量
    </div>
</div>

<script>
// カンマ区切りのフォーマットを適用しながら計算を実行
function formatAndRun(input) {
    let value = input.value.replace(/,/g, '');
    if (!isNaN(value) && value !== '') {
        input.value = Number(value).toLocaleString();
    }
    run();
}

// カンマ付き文字列を数値に変換
function getVal(id) {
    const val = document.getElementById(id).value.replace(/,/g, '');
    return parseFloat(val) || 0;
}

function changeType() {
    const type = document.getElementById('type').value;
    const entry = document.getElementById('entry');
    const settle = document.getElementById('settle');
    const baseRate = document.getElementById('baseRate');
    const rateBox = document.getElementById('rateBox');
    const rateLabel = document.getElementById('rateLabel');
    const noteArea = document.getElementById('noteArea');

    if (type === 'eurgbp') {
        rateBox.style.display = 'block';
        rateLabel.innerText = "ポンド円レート (GBP/JPY)";
        noteArea.innerHTML = "pips計算: 0.0001 = 1pips<br>損益計算: pips × 数量 × ポンド円";
        if (parseFloat(entry.value) > 2) {
            entry.value = "0.85000"; settle.value = "0.85500"; baseRate.value = "200.00";
        }
    } else if (type === 'usd') {
        rateBox.style.display = 'block';
        rateLabel.innerText = "ドル円レート (USD/JPY)";
        noteArea.innerHTML = "pips計算: 0.0001 = 1pips<br>損益計算: pips × 数量 × ドル円";
        if (parseFloat(entry.value) > 2) {
            entry.value = "1.08000"; settle.value = "1.08500"; baseRate.value = "150.00";
        }
    } else {
        rateBox.style.display = 'none';
        noteArea.innerHTML = "pips計算: 0.01 = 1pips<br>損益計算: pips × 0.01 × 数量";
        if (parseFloat(entry.value) < 2) {
            entry.value = "150.000"; settle.value = "150.500";
        }
    }
    run();
}

function run() {
    const type = document.getElementById('type').value;
    const entry = parseFloat(document.getElementById('entry').value) || 0;
    const settle = parseFloat(document.getElementById('settle').value) || 0;
    const qty = getVal('qty');
    const baseRate = parseFloat(document.getElementById('baseRate').value) || 1;

    if (qty <= 0) return;

    const diff = Math.abs(settle - entry);
    let pips = 0;
    let profit = 0;

    if (type === 'jpy') {
        pips = diff / 0.01;
        profit = diff * qty;
    } else {
        pips = diff / 0.0001;
        profit = diff * qty * baseRate;
    }

    document.getElementById('resPips').innerText = pips.toFixed(1);
    document.getElementById('resProfit').innerText = Math.round(profit).toLocaleString();
}

window.onload = run;
</script>

</body>
</html>